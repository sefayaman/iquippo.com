<div class="row">
  <div class="col-sm-2">
    <h4>Invoicing</h4>
  </div>
  <div class="col-sm-3">
    <select class="form-control" ng-if="isAdmin()" ng-model="enterpriseInvoiceVm.type" ng-change="enterpriseInvoiceVm.onTypeChange()">
      <option value="generated">Invoice Generated</option>
      <option value="tobegenerate">Invoice to be Generated</option>
    </select>
    <i class="caret"></i>
  </div> 
  <div class="col-sm-7 text-right">
    <h4>
    <button class="btn btn-success btn-md" ng-click="enterpriseInvoiceVm.exportExcel()"><i class="fa fa-file-excel-o"></i> Export Excel</button>                 
    </h4>
  </div>
</div>
<legend></legend>
<!-- invoice to be genrated -->
<div ng-if="enterpriseInvoiceVm.type == 'tobegenerate' && isAdmin()">
  <form name="searchForm">
    <div class="row form-group">          
    <div class="col-sm-3">
      <select class="form-control" ng-model="enterpriseInvoiceVm.enterpriseId" ng-click="enterpriseInvoiceVm.fireCommand(true)">
        <option value="">Select Enterprise Name</option>
        <option value="{{ent.enterpriseId}}" ng-repeat="ent in enterpriseInvoiceVm.enterprises">{{ent.fname}} {{ent.lname}}({{ent.enterpriseId}}) </option>
      </select>
      <i class="caret"></i>
    </div>
    <div class="col-sm-3">
      <select class="form-control" ng-model="enterpriseInvoiceVm.reqType" ng-click="enterpriseInvoiceVm.fireCommand(true)">
        <option value="">Select Type of Request</option>
        <option ng-repeat="req in enterpriseInvoiceVm.serviceList" value="{{req.name}}">{{req.name}}</option>
      </select>
      <i class="caret"></i>
    </div>
    <div class="col-sm-3">
      <select class="form-control" ng-model="enterpriseInvoiceVm.agencyId" ng-click="enterpriseInvoiceVm.fireCommand(true)">
        <option value="">Select Valuation Partner</option>
        <option value="{{val._id}}" ng-repeat="val in enterpriseInvoiceVm.agencies">{{val.name}}</option>
      </select>
      <i class="caret"></i>
    </div>
    <div class="col-sm-offset-1 col-sm-2">
     <!--  <button type="button" class="btn btn-danger btn-block" >Search</button> -->
    </div>
  </div>
  </form>
  <div class="row form-group featured"> 
    <div class=" col-sm-2">                   
      <button class="btn btn-primary btn-block" ng-click="enterpriseInvoiceVm.openInvoiceModal()">Generate Invoice</button>                   
    </div>      
    <div class="col-sm-offset-7 col-sm-3 tablesearch text-right">
      Search: <input type="text" placeholder="Search..." ng-model="enterpriseInvoiceVm.searchStr" ng-change="enterpriseInvoiceVm.fireCommand(true)" ng-model-options="{debounce:500}">
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th><input type="checkbox" name="" value=""> All</th>
          <th>Unique Control No</th>
          <th>Request Type</th>
          <th>Purpose</th>
          <th>Agency Name</th>
          <th>Enterprise</th>
          <th>Customer Transaction ID</th>
          <th>Customer Valuation No</th>
          <th>Asset No.</th>
          <th>Status</th>
          <th>Remark</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="entVal in enterpriseInvoiceVm.dataList">
          <td>
            <input type="checkbox" ng-disabled="entVal.status == EnterpriseValuationStatuses[5]" ng-click="enterpriseInvoiceVm.updateSelection($event,entVal)">
          </td>
          <td>{{entVal.uniqueControlNo}}</td>
          <td>{{entVal.requestType}}</td>
          <td>{{entVal.purpose}}</td>
          <td>{{entVal.agency.name}}</td>
          <td>{{entVal.customerPartyName}}</td>
          <td>{{entVal.customerTransactionId}}</td>
          <td>{{entVal.customerValuationNo}}</td>
          <td>{{entVal.assetId}}</td>
          <td>{{entVal.status}}</td>
          <td></td>

        </tr>
      </tbody>
    </table>
  </div>
    <uib-pagination total-items="pager.totalItems" ng-model="pager.currentPage" items-per-page="pager.itemsPerPage" max-size="6" ng-change="enterpriseInvoiceVm.fireCommand()" class="pagination-sm" rotate="false">  </uib-pagination>
</div>
<!-- invoice genrated -->
<div ng-if="enterpriseInvoiceVm.type == 'generated'">
  <div class="table-responsive">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th><input type="checkbox" name="" value=""> All</th>
          <th>Invoice Number</th>
          <th>Enterprise Name</th>
          <th>Enterprise Contact No.</th>
          <th>Valuation Partner Name</th>
          <th>Valuation Partner Contact No.</th>
          <th>Status</th>
          <th>Remark</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="entVal in enterpriseInvoiceVm.dataList">
          <td>
            <input type="checkbox" ng-click="enterpriseInvoiceVm.updateSelection($event,entVal)">
          </td>
          <td>{{entVal.invoiceNo}}</td>
          <td>{{entVal.enterprise.name}}</td>
          <td>{{entVal.enterprise.mobile}}</td>
          <td>{{entVal.agency.name}}</td>
           <td>{{entVal.agency.mobile}}</td>
          <td>{{entVal.status}}</td>
          <td></td>
          <td>          
              <a class="btn btn-default btn-md" ng-click="enterpriseInvoiceVm.downloadInvoice(entVal.invoiceNo)" href="javascript:void(0);"><i class="fa fa-download"></i> </a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
    <uib-pagination total-items="pager.totalItems" ng-model="pager.currentPage" items-per-page="pager.itemsPerPage" max-size="6" ng-change="enterpriseInvoiceVm.fireCommand()" class="pagination-sm" rotate="false">  </uib-pagination>
</div>

 <!-- for popup -->
 <script type="text/ng-template" id="invoiceForm.html">
   <div class="modal-header">
    <button  type="button"  class="close" ng-click="close()">&times;</button>
    <h4 class="modal-title">Invoicing</h4>
  </div>
 <div class="modal-body">
   <form name="invoiceForm" class="text-left" novalidate>
   	<div class="row">
   		<div class="col-md-12">
   			<div class="alert alert-info">Valuation Request Count: {{invoice.requestCount}}</div>
   		</div>
   	</div>
   	<div class="row"> 		
   		<div class="col-md-6 form-group" ng-class="{'has-error':invoiceForm.serviceFee.$invalid && submitted}">
        Service Fee
   		  <input type="number" class="form-control" name="serviceFee" ng-model="invoice.serviceFee" placeholder="Service Fee" required/>
   		</div>
   		<div class="col-md-6 form-group" ng-class="{'has-error':invoiceForm.servicetax.$invalid && submitted}">
        Rate for Invoice
   			<select class="form-control" name="servicetax" ng-model="invoice.taxRate" required>
          <option value="">Select</option>
          <option value="{{tax.taxRate}}" ng-repeat="tax in serviceTaxes">{{tax.taxRate}}</option>
        </select>
        <i class="caret"></i>
   		</div>
   	</div>
   	<div class="row">
   		<div class="col-md-12 text-right">
   			<button type="button" class="btn btn-danger" ng-click="generateInvoice(invoiceForm)">Genrate</button>
   		</div>
   	</div>
  </form>
  </div>
</script>